#!/usr/bin/env dash

## Defaults for test environment

export EL_fw_env=${env:-qa}
export EL_fw_index=${index:-qa}
export EL_fw_version=${version:-v9.1.17}
export EL_fw_bleversion=${bleversion:-11}
export EL_fw_mode=${mode:-Sense}
export EL_ssid=${ssid:-WG2}
export EL_pswd=${pswd:-clearwater}
export EL_ssid_len=`echo -n $EL_ssid | wc -c`
export EL_pswd_len=`echo -n $EL_pswd | wc -c`

export EL_gallons=${gal:-10000}
export EL_fc_target=${fc_target:-3}
export EL_fc_limit=${fc_limit:-1}
export EL_ph_target=${ph:-7.5}
export EL_flow_delta=${delta:-9.0}
export EL_meas_hr=${meas_hr:-10}
export EL_meas_min=${meas_min:-11}
export EL_pod_meas_hr=`expr $EL_meas_hr - 7`

export EL_pads=${pads:-1}

## Prompt for these if pod is not set on command line
export EL_user=${user:-NONE}
export EL_mfg=${mfg:-NONE}

if [ -z $pod ]; then
    echo -n "Please scan User ID: "
    read EL_user

    echo -n "Please scan Serial Number: "
    read EL_mfg

    echo -n "Please scan Pod ID: "
    read pod

    export EL_user EL_mfg
fi
export EL_pod=$pod

## test runtime configuration

export EL_timeout=${timeout:-30}
export EL_delay=${delay:-60}
export EL_DELAY_WAIT_FOR_HOST=3000
export EL_SCREENRC=.screenrc
export EL_SHELL=/bin/dash
export PATH=./tests:./tests/local:./tests/cloud:./tests/pool:./tests/diag:$PATH
export EL_serial=${serial:-NONE}
export EL_power=${power:-NONE}

## run each test given on the command line

export EL_stationlog=logs/all_results.log

for test in $*; do
    export EL_testname=`basename $test`
    export EL_log=logs/${EL_pod}-${EL_testname}.log
    export EL_BLELOG=logs/${EL_pod}-${EL_testname}-ble.log
    export EL_POWERLOG=logs/${EL_pod}-${EL_testname}-power.log
    export EL_SCANLOG=logs/${EL_pod}-${EL_testname}-blescan.log

    $test
    return=$?

    case $return in
        0) echo PASS: "$EL_testname" ;;
        *) echo FAIL: "$EL_testname" 
           return $return ;;
    esac

done
