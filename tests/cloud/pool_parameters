#!/usr/bin/env expect-lite

? $test_in_progress != 1 ? ~tests/connect.inc

##-------------------------------------------------------------------##
# XXX re-set parameters on the pod before this
##-------------------------------------------------------------------##

$test_in_progress=1
~tests/cloud/cloud_check
$test_in_progress=0

##-------------------------------------------------------------------##
# now see what we have set locally, and compare to what the cloud says
##-------------------------------------------------------------------##

; ============ $EL_testname: Test "pool gal rd" ============
>cp /dev/null $EL_SCREENLOG
>echo -n "pool gal rd" | xxd -ps
+$cmd=\n(.*)
>screen -r $EL_testname
>char-write-req 0x001b $cmd
<Characteristic value was written successfully
<Notification handle = 0x001b value: 47 61 6c 6c 6f 6e 73 3a
>
>>^A
>^D
>

; ============ $EL_testname: Verify "pool gal rd" e.g. "Gallons: $EL_gallons" ============
>dehex $EL_SCREENLOG
-<Please try again
-<Unknown
<Gallons: $EL_gallons

##------------------------------------------------------------------##
# XXX now see what the cloud says 
##------------------------------------------------------------------##

; ============ $EL_testname: Test "zfctime" ============
>cp /dev/null $EL_SCREENLOG
>echo -n "zfctime" | xxd -ps
+$cmd=\n(.*)
>screen -r $EL_testname
>char-write-req 0x001b $cmd
<Characteristic value was written successfully
<Notification handle = 0x001b value: 44 6f 73 65 20 74 69 6d 65 20 3d
>
>>^A
>^D
>

; ============ $EL_testname: Verify "zfctime" e.g. "Dose time = $EL_pump_hour:$EL_pump_min" ============
>dehex $EL_SCREENLOG
-<Please try again
-<Unknown
<Dose time = $EL_pump_hour:$EL_pump_min

##------------------------------------------------------------------##
# XXX now see what the cloud says 
##------------------------------------------------------------------##

; ============ $EL_testname: Test "flow show" ============
>cp /dev/null $EL_SCREENLOG
>echo -n "flow show" | xxd -ps
+$cmd=\n(.*)
>screen -r $EL_testname
>char-write-req 0x001b $cmd
<Characteristic value was written successfully
<Notification handle = 0x001b value: 64 74 20 3d 20 30 2e
>
>>^A
>^D
>

; ============ $EL_testname: Verify "flow show" e.g. "dt = #" ============
>dehex $EL_SCREENLOG
-<Please try again
-<Unknown
<dt =

##-------------------------------------------------------------------##
# XXX get flow delta from log messages after last reboot here
##-------------------------------------------------------------------##
##------------------------------------------------------------------##
# XXX now see what the cloud says 
##------------------------------------------------------------------##

? $test_in_progress != 1 ? ~tests/cleanup.inc
