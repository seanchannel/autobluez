#!/usr/bin/env expect-lite

? $test_in_progress != 1 ? ~tests/connect.inc

; ~~~~~~~~>  Verify firmware versions <~~~~~~~~

? $EL_serial == NONE ? [
## BLE

#XXX Template for stuffing instead of connecting
#>screen -r $EL_testname -S -X stuff "char-write-req 0x001b `echo -n version | xxd -ps`\015"
#:5

>echo -n "version" | xxd -ps
+$cmd=\n(.*)
>screen -r $EL_testname
>char-write-req 0x001b $cmd
<Characteristic value was written successfully
<Notification handle = 0x001b value: 54 49 5f 56 45 52 53
>
>>^A
>^D
>

>dehex $EL_BLELOG
-<Please try again
-<Unknown
<TI_VERS $EL_fw_bleversion
<$EL_fw_version

]::[
## Serial
*NODVPROMPT
>>picocom --quiet --logfile $EL_BLELOG --baud 115200 $EL_serial
>>version
<.+\$EL_fw_version
>
>>^A
>^X
>
*DVPROMPT
]

#----------------------------------------------------------#

? $test_in_progress != 1 ? ~tests/cleanup.inc
